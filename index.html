<!doctype html>
<html lang="vi" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Th·ªùi Kh√≥a Bi·ªÉu</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    * {
      font-family: 'Inter', sans-serif;
    }
    
    :root {
      --bg-primary: #ffffff;
      --bg-secondary: #f8fafc;
      --text-primary: #0f172a;
      --text-secondary: #64748b;
      --border-color: #e2e8f0;
      --accent-color: #3b82f6;
    }

    body.theme-minimal {
      --bg-primary: #ffffff;
      --bg-secondary: #f8fafc;
      --text-primary: #0f172a;
      --text-secondary: #64748b;
      --border-color: #e2e8f0;
      --accent-color: #3b82f6;
    }

    body.theme-ocean {
      --bg-primary: #f0f9ff;
      --bg-secondary: #e0f2fe;
      --text-primary: #082f49;
      --text-secondary: #0369a1;
      --border-color: #bae6fd;
      --accent-color: #0284c7;
    }

    body.theme-forest {
      --bg-primary: #f0fdf4;
      --bg-secondary: #dcfce7;
      --text-primary: #14532d;
      --text-secondary: #15803d;
      --border-color: #bbf7d0;
      --accent-color: #16a34a;
    }

    body.theme-sunset {
      --bg-primary: #fff7ed;
      --bg-secondary: #ffedd5;
      --text-primary: #431407;
      --text-secondary: #9a3412;
      --border-color: #fed7aa;
      --accent-color: #ea580c;
    }

    body.theme-mono {
      --bg-primary: #ffffff;
      --bg-secondary: #f5f5f5;
      --text-primary: #000000;
      --text-secondary: #737373;
      --border-color: #d4d4d4;
      --accent-color: #404040;
    }

    .schedule-cell {
      transition: all 0.2s ease;
    }
    
    .schedule-cell:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .search-item:hover {
      background: var(--bg-secondary);
    }

    .view-btn.active {
      background: var(--accent-color);
      color: white;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeIn 0.3s ease;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full theme-minimal" style="background: var(--bg-secondary);">
  <div id="app" class="h-full w-full flex flex-col overflow-auto"><!-- Header -->
   <header class="px-4 py-4 flex-shrink-0" style="background: var(--bg-primary); border-bottom: 1px solid var(--border-color);">
    <div class="max-w-7xl mx-auto">
     <h1 id="app-title" class="text-xl font-semibold mb-0.5" style="color: var(--text-primary);">Th·ªùi Kh√≥a Bi·ªÉu</h1>
     <p id="school-name" class="text-sm" style="color: var(--text-secondary);">Tr∆∞·ªùng THPT Nguy·ªÖn Du</p>
    </div>
   </header><!-- Controls -->
   <div class="px-4 py-3 flex-shrink-0" style="background: var(--bg-primary); border-bottom: 1px solid var(--border-color);">
    <div class="max-w-7xl mx-auto">
     <div class="flex flex-wrap gap-3 items-center justify-between mb-3"><!-- View Toggle -->
      <div class="flex items-center gap-2 rounded-lg p-1" style="background: var(--bg-secondary);"><button onclick="setViewMode('class')" id="btn-class" class="view-btn active px-4 py-2 rounded-md text-sm font-medium transition-all"> üè´ L·ªõp </button> <button onclick="setViewMode('teacher')" id="btn-teacher" class="view-btn px-4 py-2 rounded-md text-sm font-medium transition-all" style="color: var(--text-secondary);"> üë®‚Äçüè´ Gi√°o vi√™n </button>
      </div>
      <div class="flex items-center gap-3"><!-- Theme Selector --> <select id="theme-selector" onchange="changeTheme()" class="px-3 py-2 rounded-lg text-sm font-medium cursor-pointer" style="background: var(--bg-primary); border: 1px solid var(--border-color); color: var(--text-primary);"> <option value="minimal">üé® T·ªëi gi·∫£n</option> <option value="ocean">üåä ƒê·∫°i d∆∞∆°ng</option> <option value="forest">üå≤ R·ª´ng xanh</option> <option value="sunset">üåÖ Ho√†ng h√¥n</option> <option value="mono">‚ö´ ƒêen tr·∫Øng</option> </select> <!-- Load Button --> <button onclick="loadFromGoogleSheet()" id="load-sheet-btn" class="px-4 py-2 rounded-lg text-sm font-medium transition-all shadow-sm" style="background: var(--accent-color); color: white;"> <span id="load-text">T·∫£i d·ªØ li·ªáu</span> </button> <!-- Import Button --> <button onclick="showImportModal()" class="px-4 py-2 rounded-lg text-sm font-medium transition-all shadow-sm" style="background: var(--accent-color); color: white;"> üì• Nh·∫≠p </button>
      </div>
     </div><!-- Search Bar -->
     <div class="relative"><input type="text" id="search-input" placeholder="T√¨m ki·∫øm l·ªõp ho·∫∑c gi√°o vi√™n..." class="w-full px-4 py-2.5 rounded-lg text-sm" style="background: var(--bg-primary); border: 1px solid var(--border-color); color: var(--text-primary);" oninput="handleSearch()" onfocus="showSearchResults()" onblur="setTimeout(hideSearchResults, 200)">
      <div id="search-results" class="hidden absolute top-full mt-1 w-full rounded-lg shadow-lg max-h-64 overflow-y-auto z-50" style="background: var(--bg-primary); border: 1px solid var(--border-color);">
      </div>
     </div>
    </div>
   </div><!-- Import Modal -->
   <div id="import-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4" onclick="closeModalOnBackdrop(event)">
    <div class="rounded-xl shadow-2xl max-w-3xl w-full max-h-[90%] overflow-hidden" style="background: var(--bg-primary);" onclick="event.stopPropagation()">
     <div class="px-6 py-4" style="background: var(--accent-color); color: white;">
      <h2 class="text-xl font-bold">üì• Nh·∫≠p d·ªØ li·ªáu th·ªùi kh√≥a bi·ªÉu</h2>
      <p class="text-sm opacity-90 mt-1">D√°n d·ªØ li·ªáu t·ª´ Excel ho·∫∑c CSV</p>
     </div>
     <div class="p-6 overflow-y-auto max-h-[calc(90vh-200px)]">
      <div class="mb-4"><label class="block text-sm font-medium mb-2" style="color: var(--text-primary);"> ƒê·ªãnh d·∫°ng: Day | Hour | Students Sets | Subject | Teachers | Room </label>
       <div class="p-3 rounded-lg text-xs font-mono mb-4 overflow-x-auto" style="background: var(--bg-secondary); color: var(--text-secondary);">
        <div>
         C3 4 10A1 VƒÇN C. TRANG (V) P101
        </div>
        <div>
         S5 2 10A1 TO√ÅN N. MINH P102
        </div>
       </div>
      </div><textarea id="import-data" class="w-full h-64 px-4 py-3 rounded-lg font-mono text-sm" style="border: 1px solid var(--border-color); background: var(--bg-primary); color: var(--text-primary);" placeholder="D√°n d·ªØ li·ªáu v√†o ƒë√¢y..."></textarea>
      <div id="import-error" class="hidden mt-3 p-3 rounded-lg text-sm" style="background: #fef2f2; border: 1px solid #fecaca; color: #991b1b;"></div>
      <div id="import-success" class="hidden mt-3 p-3 rounded-lg text-sm" style="background: #f0fdf4; border: 1px solid #bbf7d0; color: #166534;"></div>
     </div>
     <div class="px-6 py-4 flex justify-end gap-3" style="background: var(--bg-secondary); border-top: 1px solid var(--border-color);"><button onclick="closeImportModal()" class="px-4 py-2 rounded-lg text-sm font-medium transition-all" style="color: var(--text-secondary);"> H·ªßy </button> <button onclick="processImport()" class="px-4 py-2 rounded-lg text-sm font-medium transition-all" style="background: var(--accent-color); color: white;"> Nh·∫≠p d·ªØ li·ªáu </button>
     </div>
    </div>
   </div><!-- Schedule Grid -->
   <div class="flex-1 overflow-auto p-4">
    <div class="max-w-7xl mx-auto">
     <div id="schedule-container" class="rounded-xl shadow-sm overflow-hidden" style="background: var(--bg-primary); border: 1px solid var(--border-color);"><!-- Schedule will be rendered here -->
     </div>
    </div>
   </div>
  </div>
  <script>
    // Configuration
    const defaultConfig = {
      app_title: 'Th·ªùi Kh√≥a Bi·ªÉu',
      school_name: 'Tr∆∞·ªùng THPT Nguy·ªÖn Du'
    };

    let config = { ...defaultConfig };
    let currentView = 'class';
    let currentSelection = '';
    let scheduleByClass = {};
    let scheduleByTeacher = {};
    let classes = [];
    let teachers = [];
    let currentTheme = 'minimal';

    const dayMap = {
      'C2': 'Th·ª© 2', 'C3': 'Th·ª© 3', 'C4': 'Th·ª© 4', 
      'C5': 'Th·ª© 5', 'C6': 'Th·ª© 6',
      'S2': 'Th·ª© 2', 'S3': 'Th·ª© 3', 'S4': 'Th·ª© 4',
      'S5': 'Th·ª© 5', 'S6': 'Th·ª© 6'
    };

    const days = ['Th·ª© 2', 'Th·ª© 3', 'Th·ª© 4', 'Th·ª© 5', 'Th·ª© 6'];
    const morningPeriods = ['S√°ng ti·∫øt 1', 'S√°ng ti·∫øt 2', 'S√°ng ti·∫øt 3', 'S√°ng ti·∫øt 4', 'S√°ng ti·∫øt 5'];
    const afternoonPeriods = ['Chi·ªÅu ti·∫øt 1', 'Chi·ªÅu ti·∫øt 2', 'Chi·ªÅu ti·∫øt 3', 'Chi·ªÅu ti·∫øt 4', 'Chi·ªÅu ti·∫øt 5'];

    const SHEET_ID = '1zkJs3cRJp4vLYq3o84HUsdfqHygt_b5rZYjR5OWPDYg';
    const GID = '0';

    // Theme functions
    function changeTheme() {
      const theme = document.getElementById('theme-selector').value;
      currentTheme = theme;
      document.body.className = `h-full theme-${theme}`;
      renderSchedule();
    }

    // Search functions
    function handleSearch() {
      const query = document.getElementById('search-input').value.toLowerCase().trim();
      const resultsDiv = document.getElementById('search-results');
      
      if (!query) {
        resultsDiv.classList.add('hidden');
        return;
      }

      const classResults = classes.filter(c => c.toLowerCase().includes(query));
      const teacherResults = teachers.filter(t => t.toLowerCase().includes(query));

      if (classResults.length === 0 && teacherResults.length === 0) {
        resultsDiv.innerHTML = '<div class="p-3 text-sm" style="color: var(--text-secondary);">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£</div>';
        resultsDiv.classList.remove('hidden');
        return;
      }

      let html = '';
      
      if (classResults.length > 0) {
        html += '<div class="p-2"><div class="text-xs font-semibold mb-1 px-2" style="color: var(--text-secondary);">L·ªöP H·ªåC</div>';
        classResults.forEach(cls => {
          html += `<div class="search-item p-2 rounded cursor-pointer text-sm" style="color: var(--text-primary);" onmousedown="selectFromSearch('class', '${cls}')">üè´ ${cls}</div>`;
        });
        html += '</div>';
      }

      if (teacherResults.length > 0) {
        html += '<div class="p-2"><div class="text-xs font-semibold mb-1 px-2" style="color: var(--text-secondary);">GI√ÅO VI√äN</div>';
        teacherResults.forEach(teacher => {
          html += `<div class="search-item p-2 rounded cursor-pointer text-sm" style="color: var(--text-primary);" onmousedown="selectFromSearch('teacher', '${teacher}')">üë®‚Äçüè´ ${teacher}</div>`;
        });
        html += '</div>';
      }

      resultsDiv.innerHTML = html;
      resultsDiv.classList.remove('hidden');
    }

    function showSearchResults() {
      if (document.getElementById('search-input').value.trim()) {
        handleSearch();
      }
    }

    function hideSearchResults() {
      document.getElementById('search-results').classList.add('hidden');
    }

    function selectFromSearch(type, value) {
      currentView = type;
      currentSelection = value;
      document.getElementById('search-input').value = type === 'class' ? `L·ªõp ${value}` : value;
      
      document.getElementById('btn-class').classList.toggle('active', type === 'class');
      document.getElementById('btn-teacher').classList.toggle('active', type === 'teacher');
      
      renderSchedule();
      hideSearchResults();
    }

    // Load from Google Sheet
    async function loadFromGoogleSheet() {
      const loadBtn = document.getElementById('load-sheet-btn');
      const loadText = document.getElementById('load-text');
      
      loadBtn.disabled = true;
      loadBtn.style.opacity = '0.6';
      loadText.textContent = 'ƒêang t·∫£i...';

      try {
        const csvUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${GID}`;
        const response = await fetch(csvUrl);
        
        if (!response.ok) {
          throw new Error('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu. Ki·ªÉm tra quy·ªÅn truy c·∫≠p.');
        }

        const csvText = await response.text();
        const lines = csvText.split('\n').filter(line => line.trim());
        
        if (lines.length === 0) {
          throw new Error('Sheet kh√¥ng c√≥ d·ªØ li·ªáu');
        }

        let startIndex = 0;
        const firstLine = lines[0].toLowerCase();
        if (firstLine.includes('day') || firstLine.includes('hour') || firstLine.includes('subject')) {
          startIndex = 1;
        }

        scheduleByClass = {};
        scheduleByTeacher = {};
        const classSet = new Set();
        const teacherSet = new Set();

        let importedCount = 0;

        for (let i = startIndex; i < lines.length; i++) {
          const line = lines[i].trim();
          if (!line) continue;

          const parts = parseCSVLine(line);
          
          if (parts.length < 4) continue;

          const dayCode = parts[0].toUpperCase();
          const hour = parseInt(parts[1]);
          const studentSet = parts[2];
          const subject = parts[3].toUpperCase().replace(/\s+/g, '');
          const teacher = parts[4] || 'Ch∆∞a ph√¢n c√¥ng';
          const room = parts[5] || '';

          const isMorning = dayCode.startsWith('S');
          const isAfternoon = dayCode.startsWith('C');
          
          if (!isMorning && !isAfternoon) continue;

          const dayName = dayMap[dayCode];
          if (!dayName) continue;
          if (isNaN(hour) || hour < 1 || hour > 5) continue;

          const periodName = isMorning ? `S√°ng ti·∫øt ${hour}` : `Chi·ªÅu ti·∫øt ${hour}`;

          if (!scheduleByClass[studentSet]) {
            scheduleByClass[studentSet] = {};
            days.forEach(d => {
              scheduleByClass[studentSet][d] = {};
            });
          }

          if (!scheduleByTeacher[teacher]) {
            scheduleByTeacher[teacher] = {};
            days.forEach(d => {
              scheduleByTeacher[teacher][d] = {};
            });
          }

          scheduleByClass[studentSet][dayName][periodName] = {
            subject: subject,
            teacher: teacher,
            room: room
          };

          scheduleByTeacher[teacher][dayName][periodName] = {
            subject: subject,
            class: studentSet,
            room: room
          };

          classSet.add(studentSet);
          teacherSet.add(teacher);
          importedCount++;
        }

        if (importedCount === 0) {
          throw new Error('Kh√¥ng c√≥ d·ªØ li·ªáu h·ª£p l·ªá');
        }

        classes = Array.from(classSet).sort();
        teachers = Array.from(teacherSet).sort();

        if (classes.length === 0) {
          throw new Error('Kh√¥ng t√¨m th·∫•y l·ªõp n√†o');
        }

        loadText.textContent = `‚úì ƒê√£ t·∫£i ${importedCount} ti·∫øt`;
        
        setTimeout(() => {
          loadText.textContent = 'T·∫£i d·ªØ li·ªáu';
          loadBtn.disabled = false;
          loadBtn.style.opacity = '1';
        }, 2000);

        currentView = 'class';
        currentSelection = classes[0];
        setViewMode('class');

      } catch (error) {
        loadText.textContent = '‚úó L·ªói';
        
        const errorDiv = document.createElement('div');
        errorDiv.className = 'fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50';
        errorDiv.style.background = '#dc2626';
        errorDiv.style.color = 'white';
        errorDiv.textContent = error.message;
        document.body.appendChild(errorDiv);
        
        setTimeout(() => {
          errorDiv.remove();
          loadText.textContent = 'T·∫£i d·ªØ li·ªáu';
          loadBtn.disabled = false;
          loadBtn.style.opacity = '1';
        }, 3000);
      }
    }

    function parseCSVLine(line) {
      const result = [];
      let current = '';
      let inQuotes = false;
      
      for (let i = 0; i < line.length; i++) {
        const char = line[i];
        
        if (char === '"') {
          inQuotes = !inQuotes;
        } else if (char === ',' && !inQuotes) {
          result.push(current.trim());
          current = '';
        } else {
          current += char;
        }
      }
      
      result.push(current.trim());
      return result;
    }

    // Modal functions
    function showImportModal() {
      document.getElementById('import-modal').classList.remove('hidden');
      document.getElementById('import-modal').classList.add('flex');
      document.getElementById('import-error').classList.add('hidden');
      document.getElementById('import-success').classList.add('hidden');
    }

    function closeImportModal() {
      document.getElementById('import-modal').classList.add('hidden');
      document.getElementById('import-modal').classList.remove('flex');
      document.getElementById('import-data').value = '';
    }

    function closeModalOnBackdrop(event) {
      if (event.target.id === 'import-modal') {
        closeImportModal();
      }
    }

    function processImport() {
      const data = document.getElementById('import-data').value.trim();
      const errorDiv = document.getElementById('import-error');
      const successDiv = document.getElementById('import-success');
      
      errorDiv.classList.add('hidden');
      successDiv.classList.add('hidden');

      if (!data) {
        errorDiv.textContent = '‚ùå Vui l√≤ng nh·∫≠p d·ªØ li·ªáu!';
        errorDiv.classList.remove('hidden');
        return;
      }

      try {
        const lines = data.split('\n').filter(line => line.trim());
        
        if (lines.length === 0) {
          throw new Error('Kh√¥ng c√≥ d·ªØ li·ªáu h·ª£p l·ªá');
        }

        let startIndex = 0;
        const firstLine = lines[0].toLowerCase();
        if (firstLine.includes('day') || firstLine.includes('hour') || firstLine.includes('subject')) {
          startIndex = 1;
        }

        scheduleByClass = {};
        scheduleByTeacher = {};
        const classSet = new Set();
        const teacherSet = new Set();

        let importedCount = 0;

        for (let i = startIndex; i < lines.length; i++) {
          const line = lines[i].trim();
          if (!line) continue;

          const parts = line.split(/\t+|\s{2,}/).map(p => p.trim()).filter(p => p);
          
          if (parts.length < 4) continue;

          const dayCode = parts[0].toUpperCase();
          const hour = parseInt(parts[1]);
          const studentSet = parts[2];
          const subject = parts[3].toUpperCase();
          const teacher = parts[4] || 'Ch∆∞a ph√¢n c√¥ng';
          const room = parts[5] || '';

          const isMorning = dayCode.startsWith('S');
          const isAfternoon = dayCode.startsWith('C');
          
          if (!isMorning && !isAfternoon) continue;

          const dayName = dayMap[dayCode];
          if (!dayName) continue;
          if (isNaN(hour) || hour < 1 || hour > 5) continue;

          const periodName = isMorning ? `S√°ng ti·∫øt ${hour}` : `Chi·ªÅu ti·∫øt ${hour}`;

          if (!scheduleByClass[studentSet]) {
            scheduleByClass[studentSet] = {};
            days.forEach(d => {
              scheduleByClass[studentSet][d] = {};
            });
          }

          if (!scheduleByTeacher[teacher]) {
            scheduleByTeacher[teacher] = {};
            days.forEach(d => {
              scheduleByTeacher[teacher][d] = {};
            });
          }

          scheduleByClass[studentSet][dayName][periodName] = {
            subject: subject,
            teacher: teacher,
            room: room
          };

          scheduleByTeacher[teacher][dayName][periodName] = {
            subject: subject,
            class: studentSet,
            room: room
          };

          classSet.add(studentSet);
          teacherSet.add(teacher);
          importedCount++;
        }

        if (importedCount === 0) {
          throw new Error('Kh√¥ng c√≥ d·ªØ li·ªáu h·ª£p l·ªá');
        }

        classes = Array.from(classSet).sort();
        teachers = Array.from(teacherSet).sort();

        if (classes.length === 0) {
          throw new Error('Kh√¥ng t√¨m th·∫•y l·ªõp n√†o');
        }

        successDiv.textContent = `‚úÖ ƒê√£ nh·∫≠p ${importedCount} ti·∫øt h·ªçc!`;
        successDiv.classList.remove('hidden');

        setTimeout(() => {
          closeImportModal();
          currentView = 'class';
          currentSelection = classes[0];
          setViewMode('class');
        }, 1500);

      } catch (error) {
        errorDiv.textContent = `‚ùå L·ªói: ${error.message}`;
        errorDiv.classList.remove('hidden');
      }
    }

    // View functions
    function setViewMode(mode) {
      currentView = mode;
      
      document.getElementById('btn-class').classList.toggle('active', mode === 'class');
      document.getElementById('btn-teacher').classList.toggle('active', mode === 'teacher');

      if (mode === 'class' && classes.length > 0) {
        currentSelection = classes[0];
      } else if (mode === 'teacher' && teachers.length > 0) {
        currentSelection = teachers[0];
      }
      
      document.getElementById('search-input').value = '';
      renderSchedule();
    }

    function renderSchedule() {
      const container = document.getElementById('schedule-container');
      const schedule = currentView === 'class' 
        ? scheduleByClass[currentSelection] 
        : scheduleByTeacher[currentSelection];

      if (!schedule || !currentSelection) {
        container.innerHTML = '<div class="p-8 text-center text-sm" style="color: var(--text-secondary);">S·ª≠ d·ª•ng t√¨m ki·∫øm ƒë·ªÉ ch·ªçn l·ªõp ho·∫∑c gi√°o vi√™n</div>';
        return;
      }

      const morningTimes = ['7:00-7:45', '7:45-8:30', '9:00-9:45', '9:45-10:30', '10:30-11:15'];
      const afternoonTimes = ['1:00-1:45', '1:45-2:30', '2:30-3:15', '3:45-4:30', '4:30-5:15'];

      let html = `
        <div class="p-4 border-b" style="border-color: var(--border-color);">
          <div class="text-lg font-semibold" style="color: var(--text-primary);">
            ${currentView === 'class' ? `üè´ L·ªõp ${currentSelection}` : `üë®‚Äçüè´ ${currentSelection}`}
          </div>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full min-w-[800px]">
            <thead>
              <tr style="background: var(--bg-secondary);">
                <th class="px-3 py-3 text-left text-xs font-semibold uppercase tracking-wider w-24" style="color: var(--text-secondary); border-bottom: 1px solid var(--border-color); border-right: 1px solid var(--border-color);">
                  Ti·∫øt
                </th>
      `;

      days.forEach(day => {
        html += `
          <th class="px-3 py-3 text-center text-xs font-semibold uppercase tracking-wider" style="color: var(--text-secondary); border-bottom: 1px solid var(--border-color); border-right: 1px solid var(--border-color);">
            ${day}
          </th>
        `;
      });

      html += `</tr></thead><tbody>`;

      // Morning sessions
      morningPeriods.forEach((period, idx) => {
        html += `<tr>
          <td class="px-3 py-2 text-xs" style="background: var(--bg-secondary); border-right: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color); color: var(--text-primary);">
            <div class="font-medium">S√°ng ${idx + 1}</div>
            <div class="opacity-60">${morningTimes[idx]}</div>
          </td>
        `;

        days.forEach(day => {
          const lesson = schedule[day][period];
          if (lesson) {
            html += `
              <td class="px-2 py-2" style="border-right: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color);">
                <div class="schedule-cell rounded-lg p-2.5 text-xs font-medium fade-in" style="background: var(--bg-secondary); color: var(--text-primary);">
                  <div class="mb-1">${lesson.subject}</div>
                  <div class="opacity-60">
                    ${currentView === 'class' ? lesson.teacher : lesson.class}
                  </div>
                  ${lesson.room ? `<div class="opacity-50 mt-1">${lesson.room}</div>` : ''}
                </div>
              </td>
            `;
          } else {
            html += `<td style="border-right: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color);"></td>`;
          }
        });

        html += `</tr>`;
      });

      // Afternoon sessions
      afternoonPeriods.forEach((period, idx) => {
        html += `<tr>
          <td class="px-3 py-2 text-xs" style="background: var(--bg-secondary); border-right: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color); color: var(--text-primary);">
            <div class="font-medium">Chi·ªÅu ${idx + 1}</div>
            <div class="opacity-60">${afternoonTimes[idx]}</div>
          </td>
        `;

        days.forEach(day => {
          const lesson = schedule[day][period];
          if (lesson) {
            html += `
              <td class="px-2 py-2" style="border-right: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color);">
                <div class="schedule-cell rounded-lg p-2.5 text-xs font-medium fade-in" style="background: var(--bg-secondary); color: var(--text-primary);">
                  <div class="mb-1">${lesson.subject}</div>
                  <div class="opacity-60">
                    ${currentView === 'class' ? lesson.teacher : lesson.class}
                  </div>
                  ${lesson.room ? `<div class="opacity-50 mt-1">${lesson.room}</div>` : ''}
                </div>
              </td>
            `;
          } else {
            html += `<td style="border-right: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color);"></td>`;
          }
        });

        html += `</tr>`;
      });

      html += `</tbody></table></div>`;
      container.innerHTML = html;
    }

    function applyConfig(cfg) {
      document.getElementById('app-title').textContent = cfg.app_title || defaultConfig.app_title;
      document.getElementById('school-name').textContent = cfg.school_name || defaultConfig.school_name;
    }

    // Initialize Element SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (cfg) => {
          config = { ...defaultConfig, ...cfg };
          applyConfig(config);
        },
        mapToCapabilities: (cfg) => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (cfg) => new Map([
          ['app_title', cfg.app_title || defaultConfig.app_title],
          ['school_name', cfg.school_name || defaultConfig.school_name]
        ])
      });
    }

    // Auto-load from Google Sheet on page load
    loadFromGoogleSheet();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9bef4ec341aea880',t:'MTc2ODU4NDI3OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
