<!DOCTYPE html>
<html lang="vi" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Th·ªùi Kh√≥a Bi·ªÉutitle>
  <meta name="theme-color" content="#6366f1">
  <script src="https://cdn.tailwindcss.com">script>
  <script src="/_sdk/element_sdk.js">script>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Quicksand', sans-serif;
    }
    
    :root {
      --bg-main: #fafafa;
      --bg-secondary: #ffffff;
      --text-primary: #1a202c;
      --text-secondary: #718096;
      --border-color: #e2e8f0;
      --accent-color: #8b5cf6;
      --accent-hover: #7c3aed;
    }
    
    [data-theme="dark"] {
      --bg-main: #0f172a;
      --bg-secondary: #1e293b;
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --border-color: #334155;
      --accent-color: #a78bfa;
      --accent-hover: #8b5cf6;
    }
    
    body {
      background: var(--bg-main);
      color: var(--text-primary);
      transition: background 0.3s, color 0.3s;
    }
    
    .card-bg {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
    }
    
    .secondary-bg {
      background: var(--bg-main);
    }
    
    .text-primary {
      color: var(--text-primary);
    }
    
    .text-secondary {
      color: var(--text-secondary);
    }
    
    .border-custom {
      border-color: var(--border-color);
    }
    
    .schedule-grid {
      display: grid;
      grid-template-columns: 100px repeat(5, 1fr);
      gap: 2px;
      background: var(--border-color);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      overflow: hidden;
    }
    
    .schedule-cell {
      background: var(--bg-secondary);
      padding: 14px;
      min-height: 90px;
      position: relative;
    }
    
    .schedule-header {
      background: linear-gradient(135deg, var(--accent-color) 0%, var(--accent-hover) 100%);
      color: white;
      font-weight: 700;
      padding: 14px;
      text-align: center;
      font-size: 1rem;
    }
    
    .schedule-time {
      background: var(--bg-main);
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 0.813rem;
      color: var(--text-primary);
    }
    
    .session-header {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: white;
      font-weight: 700;
      padding: 12px;
      text-align: center;
      font-size: 1.125rem;
      grid-column: 1 / -1;
    }
    
    .lesson-card {
      background: linear-gradient(135deg, var(--accent-color) 0%, var(--accent-hover) 100%);
      color: white;
      border-radius: 8px;
      padding: 10px;
      font-size: 0.813rem;
      height: 100%;
      display: flex;
      flex-direction: column;
      gap: 5px;
      box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);
    }
    
    .lesson-subject {
      font-weight: 700;
      font-size: 0.938rem;
      line-height: 1.3;
    }
    
    .lesson-info {
      opacity: 0.95;
      font-size: 0.75rem;
      line-height: 1.4;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    @media print {
      body {
        background: white !important;
        color: black !important;
      }
      
      .no-print {
        display: none !important;
      }
      
      .print-page {
        page-break-after: always;
        page-break-inside: avoid;
      }
      
      .print-page:last-child {
        page-break-after: auto;
      }
      
      .schedule-grid {
        background: #e5e7eb;
        border: 2px solid #d1d5db;
        gap: 1px;
      }
      
      .schedule-cell {
        background: white;
        border: none;
        page-break-inside: avoid;
      }
      
      .schedule-header {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%) !important;
        color: white !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      
      .session-header {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%) !important;
        color: white !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      
      .schedule-time {
        background: #f9fafb !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      
      .lesson-card {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%) !important;
        color: white !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      
      @page {
        size: A4 landscape;
        margin: 1cm;
      }
    }
    
    .loading-spinner {
      border: 3px solid rgba(139, 92, 246, 0.2);
      border-top: 3px solid #8b5cf6;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .btn-primary {
      background: var(--accent-color);
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 0.75rem;
      font-weight: 600;
      transition: all 0.2s;
      border: none;
      cursor: pointer;
    }
    
    .btn-primary:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
    }
    
    .btn-secondary {
      background: var(--bg-secondary);
      color: var(--text-primary);
      padding: 0.625rem 1.25rem;
      border-radius: 0.75rem;
      font-weight: 600;
      transition: all 0.2s;
      border: 1px solid var(--border-color);
      cursor: pointer;
    }
    
    .btn-secondary:hover {
      background: var(--bg-main);
      border-color: var(--accent-color);
    }
    
    select, input {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      padding: 0.75rem 1rem;
      border-radius: 0.75rem;
      font-size: 0.938rem;
      transition: all 0.2s;
    }
    
    select:focus, input:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
    }
    
    .toast {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: var(--accent-color);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 0.75rem;
      box-shadow: 0 10px 25px rgba(139, 92, 246, 0.5);
      z-index: 1000;
      animation: slideIn 0.3s ease-out;
      font-weight: 600;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
  style>
  <style>@view-transition { navigation: auto; }style>
  <script src="/_sdk/data_sdk.js" type="text/javascript">script>
 head>
 <body class="h-full">
  <div id="app-wrapper" class="min-h-full w-full overflow-auto">-- Loading State -->
   <div id="loading-state" class="flex flex-col items-center justify-center min-h-full p-8">
    <div class="loading-spinner mb-4">div>
    <p class="text-primary font-semibold">ƒêang t·∫£i d·ªØ li·ªáu t·ª´ Google Sheets...p>
   div>-- Main Content -->
   <div id="main-content" class="hidden">-- Navigation -->
    <nav class="no-print card-bg border-b border-custom sticky top-0 z-50">
     <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
       <div class="flex items-center gap-3">
        <svg class="w-9 h-9" style="color: var(--accent-color)" fill="currentColor" viewbox="0 0 20 20"><path d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z">path>
        svg>
        <div>
         <h1 id="school-name" class="text-xl font-bold text-primary">Th·ªùi Kh√≥a Bi·ªÉuh1>
         <p id="school-year" class="text-xs text-secondary">NƒÉm h·ªçc 2024-2025p>
        div>
       div>
       <div class="flex items-center gap-2"><button onclick="toggleDarkMode()" class="btn-secondary p-2" aria-label="Toggle dark mode">
         <svg id="icon-light" class="w-5 h-5 hidden" fill="currentColor" viewbox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z">path>
         svg>
         <svg id="icon-dark" class="w-5 h-5" fill="currentColor" viewbox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z">path>
         svg>button> <button onclick="refreshData()" class="btn-secondary p-2" aria-label="Refresh data">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">path>
         svg>button>
       div>
      div>
     div>
    nav>-- Controls -->
    <div class="no-print max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
     <div class="card-bg rounded-xl p-6 mb-6 shadow-sm">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
       <div><label for="view-type" class="block text-sm font-bold mb-2 text-primary">Xem theolabel> <select id="view-type" onchange="changeViewType()" class="w-full"> <option value="all">T·∫•t c·∫£option> <option value="class">Theo l·ªõpoption> <option value="teacher">Theo gi√°o vi√™noption> select>
       div>
       <div id="filter-container"><label for="filter-select" class="block text-sm font-bold mb-2 text-primary">Ch·ªçnlabel> <select id="filter-select" onchange="applyFilter()" class="w-full"> <option value="">-- Ch·ªçn --option> select>
       div>
       <div class="flex items-end"><button onclick="printSchedule()" class="btn-primary w-full flex items-center justify-center gap-2">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z">path>
         svg> In / Xu·∫•t PDF button>
       div>
      div>
     div>
    div>-- Schedule Container -->
    <div id="schedule-container" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-8">
    div>
   div>-- Error State -->
   <div id="error-state" class="hidden flex flex-col items-center justify-center min-h-full p-8 text-center">
    <svg class="w-20 h-20 text-secondary mb-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z">path>
    svg>
    <h2 class="text-2xl font-bold mb-2 text-primary">Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáuh2>
    <p id="error-message" class="text-secondary mb-6">ƒê√£ x·∫£y ra l·ªói khi t·∫£i d·ªØ li·ªáu t·ª´ Google Sheetsp><button onclick="refreshData()" class="btn-primary">Th·ª≠ l·∫°ibutton>
   div>
  div>
  <script>
    const DATA_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQwOEHVTQIC1AXGYCilV9Zo6LZLaliGTl8a4IL5CI662fRcPaIxp02ao9KO06XVXmdnTsaz_i3opSyS/pub?output=csv';
    
    const DAYS = ['', 'Th·ª© 2', 'Th·ª© 3', 'Th·ª© 4', 'Th·ª© 5', 'Th·ª© 6'];
    const PERIODS_MORNING = [
      { label: 'Ti·∫øt 1', value: 1, session: 'morning' },
      { label: 'Ti·∫øt 2', value: 2, session: 'morning' },
      { label: 'Ti·∫øt 3', value: 3, session: 'morning' },
      { label: 'Ti·∫øt 4', value: 4, session: 'morning' },
      { label: 'Ti·∫øt 5', value: 5, session: 'morning' }
    ];
    const PERIODS_AFTERNOON = [
      { label: 'Ti·∫øt 1', value: 1, session: 'afternoon' },
      { label: 'Ti·∫øt 2', value: 2, session: 'afternoon' },
      { label: 'Ti·∫øt 3', value: 3, session: 'afternoon' },
      { label: 'Ti·∫øt 4', value: 4, session: 'afternoon' },
      { label: 'Ti·∫øt 5', value: 5, session: 'afternoon' }
    ];
    
    let allData = [];
    let scheduleData = [];
    let classes = new Set();
    let teachers = new Set();
    let currentView = 'all';
    let currentFilter = '';
    let config = {};
    
    const defaultConfig = {
      school_name: 'Th·ªùi Kh√≥a Bi·ªÉu',
      school_year: 'NƒÉm h·ªçc 2024-2025'
    };
    
    // Service Worker Registration
    if ('serviceWorker' in navigator) {
      const swCode = `
        const CACHE_NAME = 'tkb-cache-v1';
        const urlsToCache = ['/'];
        
        self.addEventListener('install', event => {
          event.waitUntil(
            caches.open(CACHE_NAME).then(cache => cache.addAll(urlsToCache))
          );
        });
        
        self.addEventListener('fetch', event => {
          event.respondWith(
            caches.match(event.request).then(response => response || fetch(event.request))
          );
        });
      `;
      const blob = new Blob([swCode], { type: 'application/javascript' });
      const swUrl = URL.createObjectURL(blob);
      navigator.serviceWorker.register(swUrl);
    }
    
    // Parse CSV
    function parseCSV(csv) {
      const lines = csv.trim().split('\n');
      const result = [];
      
      for (const line of lines) {
        if (line.trim()) {
          const row = [];
          let current = '';
          let inQuotes = false;
          
          for (let i = 0; i < line.length; i++) {
            const char = line[i];
            
            if (char === '"') {
              inQuotes = !inQuotes;
            } else if (char === ',' && !inQuotes) {
              row.push(current.trim());
              current = '';
            } else {
              current += char;
            }
          }
          row.push(current.trim());
          result.push(row);
        }
      }
      
      return result;
    }
    
    // Transform data to schedule format
    function transformData(data) {
      if (!data || data.length === 0) return [];
      
      const headers = data[0].map(h => h.toLowerCase().trim());
      const rows = data.slice(1);
      
      // T√¨m index c√°c c·ªôt theo t√™n ch√≠nh x√°c
      const dayIdx = headers.indexOf('day');
      const hourIdx = headers.indexOf('hour');
      const classIdx = headers.indexOf('students sets');
      const subjectIdx = headers.indexOf('subject');
      const teacherIdx = headers.indexOf('teachers');
      const roomIdx = headers.indexOf('room');
      
      const schedule = [];
      classes.clear();
      teachers.clear();
      
      rows.forEach(row => {
        if (row.length > 0 && row.join('').trim()) {
          const dayStr = row[dayIdx] || '';
          const hour = row[hourIdx] || '';
          const className = row[classIdx] || '';
          const subject = row[subjectIdx] || '';
          const teacher = row[teacherIdx] || '';
          const room = row[roomIdx] || '';
          
          if (className && subject && dayStr && hour) {
            classes.add(className);
            if (teacher) teachers.add(teacher);
            
            const parsedDay = parseDayString(dayStr);
            
            schedule.push({
              class: className,
              teacher: teacher,
              subject: subject,
              room: room,
              day: parsedDay.day,
              session: parsedDay.session,
              period: parsePeriodNumber(hour)
            });
          }
        }
      });
      
      return schedule;
    }
    
    function parseDayString(dayStr) {
      const str = dayStr.toUpperCase().trim();
      let session = 'morning';
      let day = 0;
      
      // Ki·ªÉm tra bu·ªïi (S = s√°ng, C = chi·ªÅu)
      if (str.startsWith('C')) {
        session = 'afternoon';
      }
      
      // L·∫•y s·ªë th·ª©
      if (str.includes('2')) day = 1;
      else if (str.includes('3')) day = 2;
      else if (str.includes('4')) day = 3;
      else if (str.includes('5')) day = 4;
      else if (str.includes('6')) day = 5;
      
      return { day, session };
    }
    
    function parsePeriodNumber(periodStr) {
      const match = periodStr.match(/\d+/);
      return match ? parseInt(match[0]) : 0;
    }
    
    // Fetch data
    async function fetchData() {
      showLoading();
      
      try {
        const response = await fetch(DATA_URL);
        if (!response.ok) throw new Error('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu t·ª´ Google Sheets');
        
        const csv = await response.text();
        allData = parseCSV(csv);
        scheduleData = transformData(allData);
        
        if (scheduleData.length === 0) {
          throw new Error('Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu h·ª£p l·ªá trong b·∫£ng');
        }
        
        // Cache data for offline
        localStorage.setItem('tkb-cache', JSON.stringify({ data: allData, timestamp: Date.now() }));
        
        updateFilterOptions();
        renderSchedule();
        showToast('‚úÖ ƒê√£ t·∫£i d·ªØ li·ªáu th√†nh c√¥ng');
        showContent();
        
      } catch (error) {
        // Try offline cache
        const cached = localStorage.getItem('tkb-cache');
        if (cached) {
          const { data } = JSON.parse(cached);
          allData = data;
          scheduleData = transformData(allData);
          updateFilterOptions();
          renderSchedule();
          showToast('üì± ƒêang d√πng d·ªØ li·ªáu offline');
          showContent();
        } else {
          showError(error.message);
        }
      }
    }
    
    function updateFilterOptions() {
      const select = document.getElementById('filter-select');
      select.innerHTML = '<option value="">-- Ch·ªçn --option>';
      
      if (currentView === 'class') {
        Array.from(classes).sort().forEach(c => {
          const opt = document.createElement('option');
          opt.value = c;
          opt.textContent = c;
          select.appendChild(opt);
        });
      } else if (currentView === 'teacher') {
        Array.from(teachers).sort().forEach(t => {
          const opt = document.createElement('option');
          opt.value = t;
          opt.textContent = t;
          select.appendChild(opt);
        });
      }
    }
    
    function changeViewType() {
      currentView = document.getElementById('view-type').value;
      currentFilter = '';
      document.getElementById('filter-select').value = '';
      updateFilterOptions();
      renderSchedule();
    }
    
    function applyFilter() {
      currentFilter = document.getElementById('filter-select').value;
      renderSchedule();
    }
    
    function renderSchedule() {
      const container = document.getElementById('schedule-container');
      
      if (currentView === 'all') {
        container.innerHTML = renderAllSchedule();
      } else if (currentView === 'class' && currentFilter) {
        container.innerHTML = renderSingleSchedule(currentFilter, 'class');
      } else if (currentView === 'teacher' && currentFilter) {
        container.innerHTML = renderSingleSchedule(currentFilter, 'teacher');
      } else {
        container.innerHTML = '<div class="text-center text-secondary py-12 font-semibold">Vui l√≤ng ch·ªçn l·ªõp ho·∫∑c gi√°o vi√™ndiv>';
      }
    }
    
    function renderAllSchedule() {
      const sortedClasses = Array.from(classes).sort();
      let html = '';
      
      sortedClasses.forEach((className, idx) => {
        html += `<div class="print-page mb-8">`;
        html += renderSingleSchedule(className, 'class');
        html += `div>`;
      });
      
      return html;
    }
    
    function renderSingleSchedule(name, type) {
      const filtered = scheduleData.filter(item => 
        type === 'class' ? item.class === name : item.teacher === name
      );
      
      // T√¨m c√°c ti·∫øt c√≥ l·ªãch cho bu·ªïi s√°ng
      const morningPeriods = PERIODS_MORNING.filter(period => {
        return filtered.some(l => l.session === 'morning' && l.period === period.value);
      });
      
      // T√¨m c√°c ti·∫øt c√≥ l·ªãch cho bu·ªïi chi·ªÅu
      const afternoonPeriods = PERIODS_AFTERNOON.filter(period => {
        return filtered.some(l => l.session === 'afternoon' && l.period === period.value);
      });
      
      let html = `
        <div class="card-bg rounded-xl overflow-hidden mb-6 shadow-lg">
          <div class="p-6 border-b border-custom" style="background: linear-gradient(135deg, var(--accent-color) 0%, var(--accent-hover) 100%)">
            <h2 class="text-2xl font-bold text-white">${type === 'class' ? 'L·ªõp' : 'Gi√°o vi√™n'}: ${name}h2>
          div>
          <div class="p-6">
            <div class="schedule-grid">
              -- Header row -->
              ${DAYS.map(day => `<div class="schedule-header">${day}div>`).join('')}
      `;
      
      // Render morning session n·∫øu c√≥
      if (morningPeriods.length > 0) {
        html += `<div class="session-header">‚òÄÔ∏è Bu·ªïi S√°ngdiv>`;
        
        morningPeriods.forEach((period) => {
          html += `<div class="schedule-time">${period.label}div>`;
          
          for (let day = 1; day <= 5; day++) {
            const lesson = filtered.find(l => l.day === day && l.session === 'morning' && l.period === period.value);
            
            if (lesson) {
              html += `
                <div class="schedule-cell">
                  <div class="lesson-card">
                    <div class="lesson-subject">${lesson.subject}div>
                    ${type === 'class' ? 
                      `<div class="lesson-info">${lesson.teacher}div>` :
                      `<div class="lesson-info">${lesson.class}div>`
                    }
                    ${lesson.room ? `<div class="lesson-info">Ph√≤ng: ${lesson.room}div>` : ''}
                  div>
                div>
              `;
            } else {
              html += `<div class="schedule-cell">div>`;
            }
          }
        });
      }
      
      // Render afternoon session n·∫øu c√≥
      if (afternoonPeriods.length > 0) {
        html += `<div class="session-header">üåô Bu·ªïi Chi·ªÅudiv>`;
        
        afternoonPeriods.forEach((period) => {
          html += `<div class="schedule-time">${period.label}div>`;
          
          for (let day = 1; day <= 5; day++) {
            const lesson = filtered.find(l => l.day === day && l.session === 'afternoon' && l.period === period.value);
            
            if (lesson) {
              html += `
                <div class="schedule-cell">
                  <div class="lesson-card">
                    <div class="lesson-subject">${lesson.subject}div>
                    ${type === 'class' ? 
                      `<div class="lesson-info">${lesson.teacher}div>` :
                      `<div class="lesson-info">${lesson.class}div>`
                    }
                    ${lesson.room ? `<div class="lesson-info">Ph√≤ng: ${lesson.room}div>` : ''}
                  div>
                div>
              `;
            } else {
              html += `<div class="schedule-cell">div>`;
            }
          }
        });
      }
      
      html += `div>div>div>`;
      return html;
    }
    
    function printSchedule() {
      window.print();
    }
    
    function refreshData() {
      fetchData();
    }
    
    function toggleDarkMode() {
      const html = document.documentElement;
      const isDark = html.getAttribute('data-theme') === 'dark';
      
      html.setAttribute('data-theme', isDark ? 'light' : 'dark');
      localStorage.setItem('theme', isDark ? 'light' : 'dark');
      
      document.getElementById('icon-light').classList.toggle('hidden', !isDark);
      document.getElementById('icon-dark').classList.toggle('hidden', isDark);
    }
    
    function showLoading() {
      document.getElementById('loading-state').classList.remove('hidden');
      document.getElementById('main-content').classList.add('hidden');
      document.getElementById('error-state').classList.add('hidden');
    }
    
    function showContent() {
      document.getElementById('loading-state').classList.add('hidden');
      document.getElementById('main-content').classList.remove('hidden');
      document.getElementById('error-state').classList.add('hidden');
    }
    
    function showError(message) {
      document.getElementById('error-message').textContent = message;
      document.getElementById('loading-state').classList.add('hidden');
      document.getElementById('main-content').classList.add('hidden');
      document.getElementById('error-state').classList.remove('hidden');
    }
    
    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transition = 'opacity 0.3s';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }
    
    // Element SDK
    async function onConfigChange(newConfig) {
      config = { ...defaultConfig, ...newConfig };
      
      const schoolName = document.getElementById('school-name');
      const schoolYear = document.getElementById('school-year');
      
      if (schoolName) schoolName.textContent = config.school_name || defaultConfig.school_name;
      if (schoolYear) schoolYear.textContent = config.school_year || defaultConfig.school_year;
    }
    
    function mapToCapabilities(cfg) {
      return {
        recolorables: [],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }
    
    function mapToEditPanelValues(cfg) {
      return new Map([
        ['school_name', cfg.school_name || defaultConfig.school_name],
        ['school_year', cfg.school_year || defaultConfig.school_year]
      ]);
    }
    
    // Initialize
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }
    
    // Load saved theme
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    document.getElementById('icon-light').classList.toggle('hidden', savedTheme !== 'dark');
    document.getElementById('icon-dark').classList.toggle('hidden', savedTheme === 'dark');
    
    // Start app
    fetchData();
  script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9beefa273755dd39',t:'MTc2ODU4MDgxNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();script>body>
html>
