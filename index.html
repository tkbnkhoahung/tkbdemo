DOCTYPE html>
<html lang="vi" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Th·ªùi Kh√≥a Bi·ªÉutitle>
  <meta name="theme-color" content="#5a67d8">
  <script src="https://cdn.tailwindcss.com">script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      -webkit-font-smoothing: antialiased;
    }
    
    :root {
      --bg-main: #fafbfc;
      --bg-secondary: #ffffff;
      --text-primary: #1a202c;
      --text-secondary: #718096;
      --border-color: #e5e7eb;
      --accent-color: #5a67d8;
      --accent-hover: #4c51bf;
      --lesson-bg: #f7fafc;
    }
    
    [data-theme="dark"] {
      --bg-main: #0f1419;
      --bg-secondary: #1a202c;
      --text-primary: #e2e8f0;
      --text-secondary: #94a3b8;
      --border-color: #374151;
      --accent-color: #667eea;
      --accent-hover: #5a67d8;
      --lesson-bg: #2d3748;
    }
    
    [data-theme="ocean"] {
      --bg-main: #e0f2fe;
      --bg-secondary: #ffffff;
      --text-primary: #0c4a6e;
      --text-secondary: #0369a1;
      --border-color: #7dd3fc;
      --accent-color: #0284c7;
      --accent-hover: #0369a1;
      --lesson-bg: #f0f9ff;
    }
    
    [data-theme="sunset"] {
      --bg-main: #fff1f2;
      --bg-secondary: #ffffff;
      --text-primary: #881337;
      --text-secondary: #be123c;
      --border-color: #fda4af;
      --accent-color: #e11d48;
      --accent-hover: #be123c;
      --lesson-bg: #fff5f7;
    }
    
    [data-theme="forest"] {
      --bg-main: #ecfdf5;
      --bg-secondary: #ffffff;
      --text-primary: #064e3b;
      --text-secondary: #047857;
      --border-color: #6ee7b7;
      --accent-color: #059669;
      --accent-hover: #047857;
      --lesson-bg: #f0fdf4;
    }
    
    [data-theme="lavender"] {
      --bg-main: #faf5ff;
      --bg-secondary: #ffffff;
      --text-primary: #581c87;
      --text-secondary: #7e22ce;
      --border-color: #d8b4fe;
      --accent-color: #9333ea;
      --accent-hover: #7e22ce;
      --lesson-bg: #fdf4ff;
    }
    
    [data-theme="candy"] {
      --bg-main: #fef3c7;
      --bg-secondary: #ffffff;
      --text-primary: #78350f;
      --text-secondary: #b45309;
      --border-color: #fcd34d;
      --accent-color: #f59e0b;
      --accent-hover: #d97706;
      --lesson-bg: #fffbeb;
    }
    
    body {
      background: var(--bg-main);
      color: var(--text-primary);
      transition: background 0.2s, color 0.2s;
    }
    
    .card-bg {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
    }
    
    .text-primary {
      color: var(--text-primary);
    }
    
    .text-secondary {
      color: var(--text-secondary);
    }
    
    .border-custom {
      border-color: var(--border-color);
    }
    
    .schedule-grid {
      display: grid;
      grid-template-columns: 80px repeat(5, 1fr);
      gap: 0;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      overflow: hidden;
    }
    
    .schedule-cell {
      background: var(--bg-secondary);
      padding: 12px;
      min-height: 80px;
      border-right: 1px solid var(--border-color);
      border-bottom: 1px solid var(--border-color);
    }
    
    .schedule-cell:nth-child(6n) {
      border-right: none;
    }
    
    .schedule-header {
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-weight: 600;
      padding: 16px 12px;
      text-align: center;
      font-size: 0.875rem;
      border-right: 1px solid var(--border-color);
      border-bottom: 1px solid var(--border-color);
      letter-spacing: -0.01em;
    }
    
    .schedule-header:last-child {
      border-right: none;
    }
    
    .schedule-time {
      background: var(--bg-main);
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 0.75rem;
      color: var(--text-secondary);
      border-right: 1px solid var(--border-color);
      border-bottom: 1px solid var(--border-color);
      letter-spacing: -0.01em;
    }
    
    .session-header {
      background: var(--bg-main);
      color: var(--text-primary);
      font-weight: 600;
      padding: 10px;
      text-align: center;
      font-size: 0.813rem;
      grid-column: 1 / -1;
      border-bottom: 1px solid var(--border-color);
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }
    
    .lesson-card {
      background: var(--lesson-bg);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      padding: 10px;
      font-size: 0.813rem;
      height: 100%;
      display: flex;
      flex-direction: column;
      gap: 4px;
      transition: all 0.15s ease;
    }
    
    .lesson-card:hover {
      border-color: var(--accent-color);
      box-shadow: 0 2px 8px rgba(90, 103, 216, 0.1);
    }
    
    .lesson-subject {
      font-weight: 600;
      font-size: 0.875rem;
      line-height: 1.4;
      color: var(--text-primary);
      letter-spacing: -0.01em;
    }
    
    .lesson-info {
      font-size: 0.75rem;
      line-height: 1.5;
      color: var(--text-secondary);
      letter-spacing: -0.005em;
    }
    
    @media print {
      body {
        background: white !important;
        color: black !important;
      }
      
      .no-print {
        display: none !important;
      }
      
      .print-page {
        page-break-after: always;
        page-break-inside: avoid;
      }
      
      .print-page:last-child {
        page-break-after: auto;
      }
      
      .schedule-grid {
        border: 1px solid #d1d5db;
      }
      
      .schedule-cell, .schedule-header, .schedule-time {
        background: white !important;
        border-color: #d1d5db !important;
      }
      
      .lesson-card {
        background: #f9fafb !important;
        border-color: #d1d5db !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      
      @page {
        size: A4 landscape;
        margin: 1cm;
      }
    }
    
    .loading-spinner {
      border: 2px solid var(--border-color);
      border-top: 2px solid var(--accent-color);
      border-radius: 50%;
      width: 32px;
      height: 32px;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .btn-primary {
      background: var(--accent-color);
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
      font-weight: 500;
      font-size: 0.875rem;
      transition: all 0.15s;
      border: none;
      cursor: pointer;
      letter-spacing: -0.01em;
    }
    
    .btn-primary:hover {
      background: var(--accent-hover);
    }
    
    .btn-secondary {
      background: var(--bg-secondary);
      color: var(--text-primary);
      padding: 8px 14px;
      border-radius: 6px;
      font-weight: 500;
      font-size: 0.875rem;
      transition: all 0.15s;
      border: 1px solid var(--border-color);
      cursor: pointer;
    }
    
    .btn-secondary:hover {
      border-color: var(--accent-color);
      background: var(--bg-main);
    }
    
    select, input {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      padding: 10px 12px;
      border-radius: 6px;
      font-size: 0.875rem;
      transition: all 0.15s;
      font-family: inherit;
    }
    
    select:focus, input:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(90, 103, 216, 0.08);
    }
    
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--accent-color);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1000;
      animation: slideIn 0.3s ease-out;
      font-weight: 500;
      font-size: 0.875rem;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .theme-option {
      transition: all 0.15s;
    }
    
    .theme-option:hover {
      background: var(--accent-color);
      color: white;
    }
    
    #theme-menu {
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }
  style>
head>
<body class="h-full">
  <div id="app-wrapper" class="min-h-full w-full overflow-auto">
    -- Loading State -->
    <div id="loading-state" class="flex flex-col items-center justify-center min-h-full p-8">
      <div class="loading-spinner mb-4">div>
      <p class="text-primary font-medium text-sm">ƒêang t·∫£i d·ªØ li·ªáu...p>
    div>
    
    -- Main Content -->
    <div id="main-content" class="hidden">
      -- Navigation -->
      <nav class="no-print card-bg border-b border-custom">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex items-center justify-between h-14">
            <div class="flex items-center gap-3">
              <svg class="w-6 h-6" style="color: var(--accent-color)" fill="currentColor" viewBox="0 0 20 20">
                <path d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z">path>
              svg>
              <div>
                <h1 id="school-name" class="text-base font-semibold text-primary" style="letter-spacing: -0.02em;">Th·ªùi Kh√≥a Bi·ªÉuh1>
                <p id="school-year" class="text-xs text-secondary">2024-2025p>
              div>
            div>
            <div class="flex items-center gap-2">
              <div class="relative">
                <button onclick="toggleThemeMenu()" class="btn-secondary p-2 flex items-center gap-1" aria-label="Ch·ªçn theme">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01">path>
                  svg>
                  <span class="text-xs hidden sm:inline">Themespan>
                button>
                
                -- Theme Menu -->
                <div id="theme-menu" class="hidden absolute top-full right-0 mt-2 card-bg rounded-lg shadow-xl border border-custom p-2 z-50" style="min-width: 180px;">
                  <button onclick="changeTheme('light')" class="theme-option w-full text-left px-3 py-2 rounded text-sm hover:bg-opacity-10 flex items-center gap-2">
                    <div class="w-5 h-5 rounded-full" style="background: linear-gradient(135deg, #fafbfc 50%, #5a67d8 50%);">div>
                    <span>S√°ngspan>
                  button>
                  <button onclick="changeTheme('dark')" class="theme-option w-full text-left px-3 py-2 rounded text-sm hover:bg-opacity-10 flex items-center gap-2">
                    <div class="w-5 h-5 rounded-full" style="background: linear-gradient(135deg, #0f1419 50%, #667eea 50%);">div>
                    <span>T·ªëispan>
                  button>
                  <button onclick="changeTheme('ocean')" class="theme-option w-full text-left px-3 py-2 rounded text-sm hover:bg-opacity-10 flex items-center gap-2">
                    <div class="w-5 h-5 rounded-full" style="background: linear-gradient(135deg, #e0f2fe 50%, #0284c7 50%);">div>
                    <span>üåä ƒê·∫°i D∆∞∆°ngspan>
                  button>
                  <button onclick="changeTheme('sunset')" class="theme-option w-full text-left px-3 py-2 rounded text-sm hover:bg-opacity-10 flex items-center gap-2">
                    <div class="w-5 h-5 rounded-full" style="background: linear-gradient(135deg, #fff1f2 50%, #e11d48 50%);">div>
                    <span>üåÖ Ho√†ng H√¥nspan>
                  button>
                  <button onclick="changeTheme('forest')" class="theme-option w-full text-left px-3 py-2 rounded text-sm hover:bg-opacity-10 flex items-center gap-2">
                    <div class="w-5 h-5 rounded-full" style="background: linear-gradient(135deg, #ecfdf5 50%, #059669 50%);">div>
                    <span>üå≤ R·ª´ng Xanhspan>
                  button>
                  <button onclick="changeTheme('lavender')" class="theme-option w-full text-left px-3 py-2 rounded text-sm hover:bg-opacity-10 flex items-center gap-2">
                    <div class="w-5 h-5 rounded-full" style="background: linear-gradient(135deg, #faf5ff 50%, #9333ea 50%);">div>
                    <span>üíú Lavenderspan>
                  button>
                  <button onclick="changeTheme('candy')" class="theme-option w-full text-left px-3 py-2 rounded text-sm hover:bg-opacity-10 flex items-center gap-2">
                    <div class="w-5 h-5 rounded-full" style="background: linear-gradient(135deg, #fef3c7 50%, #f59e0b 50%);">div>
                    <span>üç¨ Candyspan>
                  button>
                div>
              div>
              <button onclick="refreshData()" class="btn-secondary p-2" aria-label="L√†m m·ªõi d·ªØ li·ªáu">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">path>
                svg>
              button>
            div>
          div>
        div>
      nav>
      
      -- Controls -->
      <div class="no-print max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="card-bg rounded-lg p-5 mb-6">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label for="view-type" class="block text-xs font-medium mb-2 text-primary">Xem theolabel>
              <select id="view-type" onchange="changeViewType()" class="w-full">
                <option value="all">T·∫•t c·∫£option>
                <option value="class">Theo l·ªõpoption>
                <option value="teacher">Theo gi√°o vi√™noption>
              select>
            div>
            <div id="filter-container">
              <label for="filter-select" class="block text-xs font-medium mb-2 text-primary">Ch·ªçnlabel>
              <select id="filter-select" onchange="applyFilter()" class="w-full">
                <option value="">-- Ch·ªçn --option>
              select>
            div>
            <div class="flex items-end">
              <button onclick="printSchedule()" class="btn-primary w-full flex items-center justify-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z">path>
                svg>
                In / Xu·∫•t PDF
              button>
            div>
          div>
        div>
      div>
      
      -- Schedule Container -->
      <div id="schedule-container" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-8">
      div>
    div>
    
    -- Error State -->
    <div id="error-state" class="hidden flex flex-col items-center justify-center min-h-full p-8 text-center">
      <svg class="w-16 h-16 text-secondary mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z">path>
      svg>
      <h2 class="text-xl font-semibold mb-2 text-primary">Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáuh2>
      <p id="error-message" class="text-secondary text-sm mb-6">ƒê√£ x·∫£y ra l·ªói khi t·∫£i d·ªØ li·ªáu t·ª´ Google Sheetsp>
      <button onclick="refreshData()" class="btn-primary">Th·ª≠ l·∫°ibutton>
    div>
  div>

  <script>
    const DATA_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQwOEHVTQIC1AXGYCilV9Zo6LZLaliGTl8a4IL5CI662fRcPaIxp02ao9KO06XVXmdnTsaz_i3opSyS/pub?output=csv';
    
    const DAYS = ['', 'Th·ª© 2', 'Th·ª© 3', 'Th·ª© 4', 'Th·ª© 5', 'Th·ª© 6'];
    const PERIODS_MORNING = [
      { label: 'Ti·∫øt 1', value: 1, session: 'morning' },
      { label: 'Ti·∫øt 2', value: 2, session: 'morning' },
      { label: 'Ti·∫øt 3', value: 3, session: 'morning' },
      { label: 'Ti·∫øt 4', value: 4, session: 'morning' },
      { label: 'Ti·∫øt 5', value: 5, session: 'morning' }
    ];
    const PERIODS_AFTERNOON = [
      { label: 'Ti·∫øt 1', value: 1, session: 'afternoon' },
      { label: 'Ti·∫øt 2', value: 2, session: 'afternoon' },
      { label: 'Ti·∫øt 3', value: 3, session: 'afternoon' },
      { label: 'Ti·∫øt 4', value: 4, session: 'afternoon' },
      { label: 'Ti·∫øt 5', value: 5, session: 'afternoon' }
    ];
    
    let allData = [];
    let scheduleData = [];
    let classes = new Set();
    let teachers = new Set();
    let currentView = 'all';
    let currentFilter = '';
    
    function parseCSV(csv) {
      const lines = csv.trim().split('\n');
      const result = [];
      
      for (const line of lines) {
        if (line.trim()) {
          const row = [];
          let current = '';
          let inQuotes = false;
          
          for (let i = 0; i < line.length; i++) {
            const char = line[i];
            
            if (char === '"') {
              inQuotes = !inQuotes;
            } else if (char === ',' && !inQuotes) {
              row.push(current.trim());
              current = '';
            } else {
              current += char;
            }
          }
          row.push(current.trim());
          result.push(row);
        }
      }
      
      return result;
    }
    
    function transformData(data) {
      if (!data || data.length === 0) return [];
      
      const headers = data[0].map(h => h.toLowerCase().trim());
      const rows = data.slice(1);
      
      const dayIdx = headers.indexOf('day');
      const hourIdx = headers.indexOf('hour');
      const classIdx = headers.indexOf('students sets');
      const subjectIdx = headers.indexOf('subject');
      const teacherIdx = headers.indexOf('teachers');
      const roomIdx = headers.indexOf('room');
      
      const schedule = [];
      classes.clear();
      teachers.clear();
      
      rows.forEach(row => {
        if (row.length > 0 && row.join('').trim()) {
          const dayStr = row[dayIdx] || '';
          const hour = row[hourIdx] || '';
          const className = row[classIdx] || '';
          const subject = row[subjectIdx] || '';
          const teacher = row[teacherIdx] || '';
          const room = row[roomIdx] || '';
          
          if (className && subject && dayStr && hour) {
            classes.add(className);
            if (teacher) teachers.add(teacher);
            
            const parsedDay = parseDayString(dayStr);
            
            schedule.push({
              class: className,
              teacher: teacher,
              subject: subject,
              room: room,
              day: parsedDay.day,
              session: parsedDay.session,
              period: parsePeriodNumber(hour)
            });
          }
        }
      });
      
      return schedule;
    }
    
    function parseDayString(dayStr) {
      const str = dayStr.toUpperCase().trim();
      let session = 'morning';
      let day = 0;
      
      if (str.startsWith('C')) {
        session = 'afternoon';
      }
      
      if (str.includes('2')) day = 1;
      else if (str.includes('3')) day = 2;
      else if (str.includes('4')) day = 3;
      else if (str.includes('5')) day = 4;
      else if (str.includes('6')) day = 5;
      
      return { day, session };
    }
    
    function parsePeriodNumber(periodStr) {
      const match = periodStr.match(/\d+/);
      return match ? parseInt(match[0]) : 0;
    }
    
    async function fetchData() {
      showLoading();
      
      try {
        const response = await fetch(DATA_URL);
        if (!response.ok) throw new Error('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu t·ª´ Google Sheets');
        
        const csv = await response.text();
        allData = parseCSV(csv);
        scheduleData = transformData(allData);
        
        if (scheduleData.length === 0) {
          throw new Error('Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu h·ª£p l·ªá trong b·∫£ng');
        }
        
        localStorage.setItem('tkb-cache', JSON.stringify({ data: allData, timestamp: Date.now() }));
        
        updateFilterOptions();
        renderSchedule();
        showToast('ƒê√£ t·∫£i d·ªØ li·ªáu th√†nh c√¥ng');
        showContent();
        
      } catch (error) {
        const cached = localStorage.getItem('tkb-cache');
        if (cached) {
          const { data } = JSON.parse(cached);
          allData = data;
          scheduleData = transformData(allData);
          updateFilterOptions();
          renderSchedule();
          showToast('ƒêang d√πng d·ªØ li·ªáu offline');
          showContent();
        } else {
          showError(error.message);
        }
      }
    }
    
    function updateFilterOptions() {
      const select = document.getElementById('filter-select');
      select.innerHTML = '<option value="">-- Ch·ªçn --<\/option>';
      
      if (currentView === 'class') {
        Array.from(classes).sort().forEach(c => {
          const opt = document.createElement('option');
          opt.value = c;
          opt.textContent = c;
          select.appendChild(opt);
        });
      } else if (currentView === 'teacher') {
        Array.from(teachers).sort().forEach(t => {
          const opt = document.createElement('option');
          opt.value = t;
          opt.textContent = t;
          select.appendChild(opt);
        });
      }
    }
    
    function changeViewType() {
      currentView = document.getElementById('view-type').value;
      currentFilter = '';
      document.getElementById('filter-select').value = '';
      updateFilterOptions();
      renderSchedule();
    }
    
    function applyFilter() {
      currentFilter = document.getElementById('filter-select').value;
      renderSchedule();
    }
    
    function renderSchedule() {
      const container = document.getElementById('schedule-container');
      
      if (currentView === 'all') {
        container.innerHTML = renderAllSchedule();
      } else if (currentView === 'class' && currentFilter) {
        container.innerHTML = renderSingleSchedule(currentFilter, 'class');
      } else if (currentView === 'teacher' && currentFilter) {
        container.innerHTML = renderSingleSchedule(currentFilter, 'teacher');
      } else {
        container.innerHTML = '<div class="text-center text-secondary py-12 text-sm">Vui l√≤ng ch·ªçn l·ªõp ho·∫∑c gi√°o vi√™n<\/div>';
      }
    }
    
    function renderAllSchedule() {
      const sortedClasses = Array.from(classes).sort();
      let html = '';
      
      sortedClasses.forEach((className, idx) => {
        html += \`<div class="print-page mb-8">\`;
        html += renderSingleSchedule(className, 'class');
        html += \`<\/div>\`;
      });
      
      return html;
    }
    
    function renderSingleSchedule(name, type) {
      const filtered = scheduleData.filter(item => 
        type === 'class' ? item.class === name : item.teacher === name
      );
      
      const morningPeriods = PERIODS_MORNING.filter(period => {
        return filtered.some(l => l.session === 'morning' && l.period === period.value);
      });
      
      const afternoonPeriods = PERIODS_AFTERNOON.filter(period => {
        return filtered.some(l => l.session === 'afternoon' && l.period === period.value);
      });
      
      let html = \`
        <div class="card-bg rounded-lg overflow-hidden mb-6">
          <div class="p-4 border-b border-custom">
            <h2 class="text-base font-semibold text-primary">\${type === 'class' ? 'LÔøΩÔøΩÔøΩp' : 'Gi√°o vi√™n'}: \${name}<\/h2>
          <\/div>
          <div class="p-4">
            <div class="schedule-grid">
              \${DAYS.map(day => \`<div class="schedule-header">\${day}<\/div>\`).join('')}
      \`;
      
      if (morningPeriods.length > 0) {
        html += \`<div class="session-header">Bu·ªïi S√°ng<\/div>\`;
        
        morningPeriods.forEach((period) => {
          html += \`<div class="schedule-time">\${period.label}<\/div>\`;
          
          for (let day = 1; day <= 5; day++) {
            const lesson = filtered.find(l => l.day === day && l.session === 'morning' && l.period === period.value);
            
            if (lesson) {
              html += \`
                <div class="schedule-cell">
                  <div class="lesson-card">
                    <div class="lesson-subject">\${lesson.subject}<\/div>
                    \${type === 'class' ? 
                      \`<div class="lesson-info">\${lesson.teacher}<\/div>\` :
                      \`<div class="lesson-info">\${lesson.class}<\/div>\`
                    }
                    \${lesson.room ? \`<div class="lesson-info">Ph√≤ng: \${lesson.room}<\/div>\` : ''}
                  <\/div>
                <\/div>
              \`;
            } else {
              html += \`<div class="schedule-cell"><\/div>\`;
            }
          }
        });
      }
      
      if (afternoonPeriods.length > 0) {
        html += \`<div class="session-header">Bu·ªïi Chi·ªÅu<\/div>\`;
        
        afternoonPeriods.forEach((period) => {
          html += \`<div class="schedule-time">\${period.label}<\/div>\`;
          
          for (let day = 1; day <= 5; day++) {
            const lesson = filtered.find(l => l.day === day && l.session === 'afternoon' && l.period === period.value);
            
            if (lesson) {
              html += \`
                <div class="schedule-cell">
                  <div class="lesson-card">
                    <div class="lesson-subject">\${lesson.subject}<\/div>
                    \${type === 'class' ? 
                      \`<div class="lesson-info">\${lesson.teacher}<\/div>\` :
                      \`<div class="lesson-info">\${lesson.class}<\/div>\`
                    }
                    \${lesson.room ? \`<div class="lesson-info">Ph√≤ng: \${lesson.room}<\/div>\` : ''}
                  <\/div>
                <\/div>
              \`;
            } else {
              html += \`<div class="schedule-cell"><\/div>\`;
            }
          }
        });
      }
      
      html += \`<\/div><\/div><\/div>\`;
      return html;
    }
    
    function printSchedule() {
      window.print();
    }
    
    function refreshData() {
      fetchData();
    }
    
    function toggleThemeMenu() {
      const menu = document.getElementById('theme-menu');
      menu.classList.toggle('hidden');
    }
    
    function changeTheme(themeName) {
      document.documentElement.setAttribute('data-theme', themeName);
      localStorage.setItem('theme', themeName);
      document.getElementById('theme-menu').classList.add('hidden');
      showToast(\`üé® ƒê√£ chuy·ªÉn sang theme \${getThemeName(themeName)}\`);
    }
    
    function getThemeName(theme) {
      const names = {
        'light': 'S√°ng',
        'dark': 'T·ªëi',
        'ocean': 'ƒê·∫°i D∆∞∆°ng üåä',
        'sunset': 'Ho√†ng H√¥n üåÖ',
        'forest': 'R·ª´ng Xanh üå≤',
        'lavender': 'Lavender üíú',
        'candy': 'Candy üç¨'
      };
      return names[theme] || theme;
    }
    
    document.addEventListener('click', function(event) {
      const menu = document.getElementById('theme-menu');
      const button = event.target.closest('button[onclick="toggleThemeMenu()"]');
      
      if (!button && !menu.contains(event.target)) {
        menu.classList.add('hidden');
      }
    });
    
    function showLoading() {
      document.getElementById('loading-state').classList.remove('hidden');
      document.getElementById('main-content').classList.add('hidden');
      document.getElementById('error-state').classList.add('hidden');
    }
    
    function showContent() {
      document.getElementById('loading-state').classList.add('hidden');
      document.getElementById('main-content').classList.remove('hidden');
      document.getElementById('error-state').classList.add('hidden');
    }
    
    function showError(message) {
      document.getElementById('error-message').textContent = message;
      document.getElementById('loading-state').classList.add('hidden');
      document.getElementById('main-content').classList.add('hidden');
      document.getElementById('error-state').classList.remove('hidden');
    }
    
    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transition = 'opacity 0.3s';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }
    
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    
    fetchData();
  script>
body>
html>
